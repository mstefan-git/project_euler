<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14: Longest Collatz sequence | Project Euler in R</title>
  <meta name="description" content="14: Longest Collatz sequence | Project Euler in R" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="14: Longest Collatz sequence | Project Euler in R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14: Longest Collatz sequence | Project Euler in R" />
  
  
  

<meta name="author" content="Martin Stefan" />


<meta name="date" content="2023-03-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="longest-collatz-sequence.html"><a href="longest-collatz-sequence.html"><i class="fa fa-check"></i>14: Longest Collatz sequence</a>
<ul>
<li class="chapter" data-level="" data-path="longest-collatz-sequence.html"><a href="longest-collatz-sequence.html#preliminaries"><i class="fa fa-check"></i>Preliminaries</a></li>
<li class="chapter" data-level="" data-path="longest-collatz-sequence.html"><a href="longest-collatz-sequence.html#brute-force"><i class="fa fa-check"></i>Brute force</a></li>
<li class="chapter" data-level="" data-path="longest-collatz-sequence.html"><a href="longest-collatz-sequence.html#optimization"><i class="fa fa-check"></i>Optimization</a></li>
<li class="chapter" data-level="" data-path="longest-collatz-sequence.html"><a href="longest-collatz-sequence.html#further-improvements"><i class="fa fa-check"></i>Further improvements</a></li>
<li class="chapter" data-level="" data-path="longest-collatz-sequence.html"><a href="longest-collatz-sequence.html#speed-comparison"><i class="fa fa-check"></i>Speed comparison</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Project Euler in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="longest-collatz-sequence" class="section level1 hasAnchor">
<h1>14: Longest Collatz sequence<a href="longest-collatz-sequence.html#longest-collatz-sequence" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The following iterative sequence is defined for the set of positive integers:</p>
<p><span class="math display">\[
n → ~ n/2 ~~~~~~ (n ~ \text{is even})
\]</span>
<span class="math display">\[
n → ~ 3n + 1 ~~~ (n ~ \text{is odd})
\]</span></p>
<p>Using the rule above and starting with 13, we generate the following sequence:</p>
<p><span class="math display">\[
13 → 40 → 20 → 10 → 5 → 16 → 8 → 4 → 2 → 1
\]</span></p>
<p>It can be seen that this sequence (starting at 13 and finishing at 1) contains 10 terms. Although it has not been proved yet (Collatz Problem), it is thought that all starting numbers finish at 1.</p>
<p>Which starting number, under one million, produces the longest chain?</p>
<p>NOTE: Once the chain starts the terms are allowed to go above one million.</p>
<div id="preliminaries" class="section level2 hasAnchor">
<h2>Preliminaries<a href="longest-collatz-sequence.html#preliminaries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s begin by writing a simple function which can generates the next value of a Collatz sequence:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="longest-collatz-sequence.html#cb1-1" aria-hidden="true" tabindex="-1"></a>collatz <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb1-2"><a href="longest-collatz-sequence.html#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (n <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb1-3"><a href="longest-collatz-sequence.html#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb1-4"><a href="longest-collatz-sequence.html#cb1-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-5"><a href="longest-collatz-sequence.html#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">3</span><span class="sc">*</span>n<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb1-6"><a href="longest-collatz-sequence.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-7"><a href="longest-collatz-sequence.html#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here is how it works in action:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="longest-collatz-sequence.html#cb2-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb2-2"><a href="longest-collatz-sequence.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (n <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb2-3"><a href="longest-collatz-sequence.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(n)</span>
<span id="cb2-4"><a href="longest-collatz-sequence.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">collatz</span>(n)</span>
<span id="cb2-5"><a href="longest-collatz-sequence.html#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 13
## [1] 40
## [1] 20
## [1] 10
## [1] 5
## [1] 16
## [1] 8
## [1] 4
## [1] 2</code></pre>
<p>Notice that we only generate new values while <code>n &gt; 1</code>. Otherwise, we would get stuck in the cycle $1 → 4 → 2 → 1 →$. Let’s wrap our loop in a function that can generate the entire Collatz sequence for a given starting number:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="longest-collatz-sequence.html#cb4-1" aria-hidden="true" tabindex="-1"></a>collatz_sequence <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb4-2"><a href="longest-collatz-sequence.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  numbers <span class="ot">&lt;-</span> <span class="fu">c</span>(n)</span>
<span id="cb4-3"><a href="longest-collatz-sequence.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (n <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb4-4"><a href="longest-collatz-sequence.html#cb4-4" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">collatz</span>(n)</span>
<span id="cb4-5"><a href="longest-collatz-sequence.html#cb4-5" aria-hidden="true" tabindex="-1"></a>    numbers <span class="ot">&lt;-</span> <span class="fu">c</span>(numbers, n)</span>
<span id="cb4-6"><a href="longest-collatz-sequence.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-7"><a href="longest-collatz-sequence.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(numbers)</span>
<span id="cb4-8"><a href="longest-collatz-sequence.html#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here are a few sequences:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="longest-collatz-sequence.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collatz_sequence</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="longest-collatz-sequence.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collatz_sequence</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1]  5 16  8  4  2  1</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="longest-collatz-sequence.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collatz_sequence</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 10  5 16  8  4  2  1</code></pre>
</div>
<div id="brute-force" class="section level2 hasAnchor">
<h2>Brute force<a href="longest-collatz-sequence.html#brute-force" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>At this stage, we could try to brute-force the problem. I am going to do this for starting values up to 1000:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="longest-collatz-sequence.html#cb11-1" aria-hidden="true" tabindex="-1"></a>brute_force <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb11-2"><a href="longest-collatz-sequence.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  max_number <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-3"><a href="longest-collatz-sequence.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  max_length <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-4"><a href="longest-collatz-sequence.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>x) {</span>
<span id="cb11-5"><a href="longest-collatz-sequence.html#cb11-5" aria-hidden="true" tabindex="-1"></a>    numbers <span class="ot">&lt;-</span> <span class="fu">collatz_sequence</span>(i)</span>
<span id="cb11-6"><a href="longest-collatz-sequence.html#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(numbers) <span class="sc">&gt;</span> max_length) {</span>
<span id="cb11-7"><a href="longest-collatz-sequence.html#cb11-7" aria-hidden="true" tabindex="-1"></a>      max_length <span class="ot">&lt;-</span> <span class="fu">length</span>(numbers)</span>
<span id="cb11-8"><a href="longest-collatz-sequence.html#cb11-8" aria-hidden="true" tabindex="-1"></a>      max_number <span class="ot">&lt;-</span> i</span>
<span id="cb11-9"><a href="longest-collatz-sequence.html#cb11-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-10"><a href="longest-collatz-sequence.html#cb11-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-11"><a href="longest-collatz-sequence.html#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(max_number)</span>
<span id="cb11-12"><a href="longest-collatz-sequence.html#cb11-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-13"><a href="longest-collatz-sequence.html#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="longest-collatz-sequence.html#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">brute_force</span>(<span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## [1] 871</code></pre>
<p>As we can see, among all starting numbers up to 1000, 871 produces the longest Collatz sequence. However, when running this brute-force approach for starting numbers up to 1,000,000, our computer may struggle.</p>
</div>
<div id="optimization" class="section level2 hasAnchor">
<h2>Optimization<a href="longest-collatz-sequence.html#optimization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s head back to the start and have a look at the following two sequences:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="longest-collatz-sequence.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collatz_sequence</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1]  5 16  8  4  2  1</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="longest-collatz-sequence.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collatz_sequence</span>(<span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1]  6  3 10  5 16  8  4  2  1</code></pre>
<p>Notice how the last six values of <code>collatz_sequence(6)</code> (i.e., 5, 16, 8, 4, 2, 1) are the same as the sequence generated by <code>collatz_sequence(5)</code>. So when generating <code>collatz_sequence(6)</code>, we could have just stopped at “5”, because we had already established what comes after it. In fact, if we had run <code>collatz_sequence(3)</code> before, we could have even stopped at “3”.</p>
<p>This implies that when generating sequences with consecutive starting values, we can always stop within a sequence, once we encounter a value which was the starting value of a previous sequence.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="longest-collatz-sequence.html#cb17-1" aria-hidden="true" tabindex="-1"></a>better_solution <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb17-2"><a href="longest-collatz-sequence.html#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="longest-collatz-sequence.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create vector in which to store the sequence lengths</span></span>
<span id="cb17-4"><a href="longest-collatz-sequence.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  lengths <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, x)</span>
<span id="cb17-5"><a href="longest-collatz-sequence.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-6"><a href="longest-collatz-sequence.html#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate sequences for different starting values</span></span>
<span id="cb17-7"><a href="longest-collatz-sequence.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (start <span class="cf">in</span> <span class="fu">seq</span>(lengths)) {</span>
<span id="cb17-8"><a href="longest-collatz-sequence.html#cb17-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-9"><a href="longest-collatz-sequence.html#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># setup for a new sequence</span></span>
<span id="cb17-10"><a href="longest-collatz-sequence.html#cb17-10" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> start</span>
<span id="cb17-11"><a href="longest-collatz-sequence.html#cb17-11" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb17-12"><a href="longest-collatz-sequence.html#cb17-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-13"><a href="longest-collatz-sequence.html#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate new value as long as:</span></span>
<span id="cb17-14"><a href="longest-collatz-sequence.html#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   n &gt; 1: we have not reached the end of the sequence</span></span>
<span id="cb17-15"><a href="longest-collatz-sequence.html#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   n &gt;= start: we have not arrived at a previous starting value</span></span>
<span id="cb17-16"><a href="longest-collatz-sequence.html#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (n <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> n <span class="sc">&gt;=</span> start) {</span>
<span id="cb17-17"><a href="longest-collatz-sequence.html#cb17-17" aria-hidden="true" tabindex="-1"></a>      n <span class="ot">&lt;-</span> <span class="fu">collatz</span>(n)     <span class="co"># update n</span></span>
<span id="cb17-18"><a href="longest-collatz-sequence.html#cb17-18" aria-hidden="true" tabindex="-1"></a>      count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span>  <span class="co"># update the length count  </span></span>
<span id="cb17-19"><a href="longest-collatz-sequence.html#cb17-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-20"><a href="longest-collatz-sequence.html#cb17-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-21"><a href="longest-collatz-sequence.html#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add the length of the sequence at whose starting value </span></span>
<span id="cb17-22"><a href="longest-collatz-sequence.html#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we just stopped generating new values in the current sequence</span></span>
<span id="cb17-23"><a href="longest-collatz-sequence.html#cb17-23" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> count <span class="sc">+</span> lengths[n]</span>
<span id="cb17-24"><a href="longest-collatz-sequence.html#cb17-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-25"><a href="longest-collatz-sequence.html#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store the count in our vector of sequence lengths</span></span>
<span id="cb17-26"><a href="longest-collatz-sequence.html#cb17-26" aria-hidden="true" tabindex="-1"></a>    lengths[start] <span class="ot">&lt;-</span> count</span>
<span id="cb17-27"><a href="longest-collatz-sequence.html#cb17-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-28"><a href="longest-collatz-sequence.html#cb17-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-29"><a href="longest-collatz-sequence.html#cb17-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-30"><a href="longest-collatz-sequence.html#cb17-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># which starting value produced the longest sequence?</span></span>
<span id="cb17-31"><a href="longest-collatz-sequence.html#cb17-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">which.max</span>(lengths))</span>
<span id="cb17-32"><a href="longest-collatz-sequence.html#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="longest-collatz-sequence.html#cb17-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-34"><a href="longest-collatz-sequence.html#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="longest-collatz-sequence.html#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="fu">better_solution</span>(<span class="dv">999999</span>)</span></code></pre></div>
<pre><code>## [1] 837799</code></pre>
</div>
<div id="further-improvements" class="section level2 hasAnchor">
<h2>Further improvements<a href="longest-collatz-sequence.html#further-improvements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>However, we can improve our code even further. Notice that the Collatz sequence starting at 1 million has 500,000 as its next value and that the Collatz sequence starting at 999,998 hast 499,999 as its next value. This means, that all sequences with starting values less or equal to 500,000 are really just subsets of the series with starting values greater than 500,000. Therefore, we can start our search at 500,000 instead of 1. Notice also, that after every even number <code>n</code> we move closer to zero, because <code>n</code> is followed by <code>n/2</code>. Conversely, every odd number <code>n</code> leads to a greater number <code>3n+1</code>. This means that no sequence stops after an odd number. So when faced with an odd number, instead of first computing <code>3n+1</code> and in the step after that <code>(3n+1)/2</code>, we can skip the first step and compute the latter result right away. Here is the final code:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="longest-collatz-sequence.html#cb19-1" aria-hidden="true" tabindex="-1"></a>best_solution <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb19-2"><a href="longest-collatz-sequence.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="longest-collatz-sequence.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  lengths <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, x<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb19-4"><a href="longest-collatz-sequence.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-5"><a href="longest-collatz-sequence.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># start at x/2</span></span>
<span id="cb19-6"><a href="longest-collatz-sequence.html#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (start <span class="cf">in</span> <span class="fu">ceiling</span>(x<span class="sc">/</span><span class="dv">2</span>)<span class="sc">:</span>x) {</span>
<span id="cb19-7"><a href="longest-collatz-sequence.html#cb19-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-8"><a href="longest-collatz-sequence.html#cb19-8" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> start</span>
<span id="cb19-9"><a href="longest-collatz-sequence.html#cb19-9" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-10"><a href="longest-collatz-sequence.html#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (n <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> n <span class="sc">&gt;=</span> start) {</span>
<span id="cb19-11"><a href="longest-collatz-sequence.html#cb19-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb19-12"><a href="longest-collatz-sequence.html#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># single step</span></span>
<span id="cb19-13"><a href="longest-collatz-sequence.html#cb19-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (n <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb19-14"><a href="longest-collatz-sequence.html#cb19-14" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> n <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb19-15"><a href="longest-collatz-sequence.html#cb19-15" aria-hidden="true" tabindex="-1"></a>        count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb19-16"><a href="longest-collatz-sequence.html#cb19-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-17"><a href="longest-collatz-sequence.html#cb19-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># double step</span></span>
<span id="cb19-18"><a href="longest-collatz-sequence.html#cb19-18" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb19-19"><a href="longest-collatz-sequence.html#cb19-19" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> (<span class="dv">3</span><span class="sc">*</span>n<span class="sc">+</span><span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb19-20"><a href="longest-collatz-sequence.html#cb19-20" aria-hidden="true" tabindex="-1"></a>        count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb19-21"><a href="longest-collatz-sequence.html#cb19-21" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb19-22"><a href="longest-collatz-sequence.html#cb19-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-23"><a href="longest-collatz-sequence.html#cb19-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-24"><a href="longest-collatz-sequence.html#cb19-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-25"><a href="longest-collatz-sequence.html#cb19-25" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> count <span class="sc">+</span> lengths[n]</span>
<span id="cb19-26"><a href="longest-collatz-sequence.html#cb19-26" aria-hidden="true" tabindex="-1"></a>    lengths[start] <span class="ot">&lt;-</span> count</span>
<span id="cb19-27"><a href="longest-collatz-sequence.html#cb19-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-28"><a href="longest-collatz-sequence.html#cb19-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-29"><a href="longest-collatz-sequence.html#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">which.max</span>(lengths))</span>
<span id="cb19-30"><a href="longest-collatz-sequence.html#cb19-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-31"><a href="longest-collatz-sequence.html#cb19-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-32"><a href="longest-collatz-sequence.html#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="longest-collatz-sequence.html#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="fu">best_solution</span>(<span class="dv">999999</span>)</span></code></pre></div>
<pre><code>## [1] 837799</code></pre>
</div>
<div id="speed-comparison" class="section level2 hasAnchor">
<h2>Speed comparison<a href="longest-collatz-sequence.html#speed-comparison" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
},
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
