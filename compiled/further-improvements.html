<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Further improvements | Project Euler in R</title>
  <meta name="description" content="Further improvements | Project Euler in R" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Further improvements | Project Euler in R" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Further improvements | Project Euler in R" />
  
  
  

<meta name="author" content="Martin Stefan" />


<meta name="date" content="2023-03-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="optimization.html"/>
<link rel="next" href="speed-comparison.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="_style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="longest-collatz-sequence.html"><a href="longest-collatz-sequence.html"><i class="fa fa-check"></i>14: Longest Collatz sequence</a>
<ul>
<li class="chapter" data-level="" data-path="preliminaries.html"><a href="preliminaries.html"><i class="fa fa-check"></i>Preliminaries</a></li>
<li class="chapter" data-level="" data-path="brute-force.html"><a href="brute-force.html"><i class="fa fa-check"></i>Brute force</a></li>
<li class="chapter" data-level="" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i>Optimization</a></li>
<li class="chapter" data-level="" data-path="further-improvements.html"><a href="further-improvements.html"><i class="fa fa-check"></i>Further improvements</a></li>
<li class="chapter" data-level="" data-path="speed-comparison.html"><a href="speed-comparison.html"><i class="fa fa-check"></i>Speed comparison</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Project Euler in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="further-improvements" class="section level2 hasAnchor">
<h2>Further improvements<a href="further-improvements.html#further-improvements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>However, we can improve our code even further. Notice that the Collatz sequence starting at 1 million has 500,000 as its next value and that the Collatz sequence starting at 999,998 hast 499,999 as its next value. This means, that all sequences with starting values less or equal to 500,000 are really just subsets of the series with starting values greater than 500,000. Therefore, we can start our search at 500,000 instead of 1. Notice also, that after every even number <code>n</code> we move closer to zero, because <code>n</code> is followed by <code>n/2</code>. Conversely, every odd number <code>n</code> leads to a greater number <code>3n+1</code>. This means that no sequence stops after an odd number. So when faced with an odd number, instead of first computing <code>3n+1</code> and in the step after that <code>(3n+1)/2</code>, we can skip the first step and compute the latter result right away. Here is the final code:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="further-improvements.html#cb19-1" aria-hidden="true" tabindex="-1"></a>best_solution <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb19-2"><a href="further-improvements.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="further-improvements.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  lengths <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, x<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb19-4"><a href="further-improvements.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-5"><a href="further-improvements.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># start at x/2</span></span>
<span id="cb19-6"><a href="further-improvements.html#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (start <span class="cf">in</span> <span class="fu">ceiling</span>(x<span class="sc">/</span><span class="dv">2</span>)<span class="sc">:</span>x) {</span>
<span id="cb19-7"><a href="further-improvements.html#cb19-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-8"><a href="further-improvements.html#cb19-8" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> start</span>
<span id="cb19-9"><a href="further-improvements.html#cb19-9" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-10"><a href="further-improvements.html#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (n <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">&amp;</span> n <span class="sc">&gt;=</span> start) {</span>
<span id="cb19-11"><a href="further-improvements.html#cb19-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb19-12"><a href="further-improvements.html#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># single step</span></span>
<span id="cb19-13"><a href="further-improvements.html#cb19-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (n <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb19-14"><a href="further-improvements.html#cb19-14" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> n <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb19-15"><a href="further-improvements.html#cb19-15" aria-hidden="true" tabindex="-1"></a>        count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb19-16"><a href="further-improvements.html#cb19-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-17"><a href="further-improvements.html#cb19-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># double step</span></span>
<span id="cb19-18"><a href="further-improvements.html#cb19-18" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb19-19"><a href="further-improvements.html#cb19-19" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> (<span class="dv">3</span><span class="sc">*</span>n<span class="sc">+</span><span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb19-20"><a href="further-improvements.html#cb19-20" aria-hidden="true" tabindex="-1"></a>        count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb19-21"><a href="further-improvements.html#cb19-21" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb19-22"><a href="further-improvements.html#cb19-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-23"><a href="further-improvements.html#cb19-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-24"><a href="further-improvements.html#cb19-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-25"><a href="further-improvements.html#cb19-25" aria-hidden="true" tabindex="-1"></a>    count <span class="ot">&lt;-</span> count <span class="sc">+</span> lengths[n]</span>
<span id="cb19-26"><a href="further-improvements.html#cb19-26" aria-hidden="true" tabindex="-1"></a>    lengths[start] <span class="ot">&lt;-</span> count</span>
<span id="cb19-27"><a href="further-improvements.html#cb19-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-28"><a href="further-improvements.html#cb19-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-29"><a href="further-improvements.html#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">which.max</span>(lengths))</span>
<span id="cb19-30"><a href="further-improvements.html#cb19-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-31"><a href="further-improvements.html#cb19-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-32"><a href="further-improvements.html#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="further-improvements.html#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="fu">best_solution</span>(<span class="dv">999999</span>)</span></code></pre></div>
<pre><code>[1] 837799</code></pre>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="optimization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="speed-comparison.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
},
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
